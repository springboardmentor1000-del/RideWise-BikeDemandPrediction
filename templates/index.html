<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bike Rental Prediction</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .prediction-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .hero-section {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInUp 0.6s ease-out;
        }
        .hero-section h1 {
            font-size: 42px;
            font-weight: 800;
            margin-bottom: 12px;
            background: linear-gradient(135deg, #667eea, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero-section p {
            color: var(--text-muted);
            font-size: 16px;
        }
        .dataset-selector {
            margin-bottom: 32px;
            animation: fadeInUp 0.7s ease-out;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            animation: fadeInUp 0.8s ease-out;
        }
        .form-group {
            margin-bottom: 0;
        }
        .prediction-result {
            margin-top: 32px;
            padding: 24px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(240, 147, 251, 0.1));
            border-radius: 16px;
            border: 1px solid rgba(102, 126, 234, 0.3);
            text-align: center;
            animation: fadeInUp 0.9s ease-out;
        }
        .prediction-result h2 {
            font-size: 32px;
            margin: 0;
            color: var(--accent);
        }
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        .action-buttons button {
            flex: 1;
            min-width: 200px;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .loading {
            animation: pulse 1.5s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="topnav">
        <div class="left">
            <a href="/">Home</a>
            <a class="active" href="{{ url_for('index', dataset=selected_dataset or 'day') }}">Prediction</a>
            <a href="{{ url_for('insights') }}">AI Insights</a>
            <a href="{{ url_for('chatbot') }}">Chatbot</a>
            <a href="{{ url_for('contact') }}">Contact</a>
        </div>
        <div class="right">
            <span style="color: var(--text-muted); margin-right: 16px;">ğŸ‘¤ Admin</span>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>

    <div class="container prediction-container">
        <div class="hero-section">
            <h1>ğŸš´ Bike Rental Prediction</h1>
            <p>Get accurate predictions for bike rental demand using AI-powered models</p>
        </div>

        <!-- Pickle File Selection -->
        <form action="{{ url_for('filter_data') }}" method="post" class="dataset-selector">
            <fieldset>
                <legend>ï¿½ Select Pickle File</legend>
                <div style="display: flex; gap: 16px; align-items: center;">
                    <select id="dataset" name="dataset" style="flex: 1;">
                        <option value="day" {% if selected_dataset=='day' %}selected{% endif %}>ğŸ“… Daily Pickle (day_data.pkl)</option>
                        <option value="hour" {% if selected_dataset=='hour' %}selected{% endif %}>ğŸ• Hourly Pickle (hour_data.pkl)</option>
                    </select>
                    <button type="submit" style="flex: 0 0 auto; min-width: 150px;">Load Pickle File</button>
                </div>
                <p style="color: var(--text-muted); font-size: 13px; margin-top: 8px; margin-bottom: 0;">
                    ğŸ’¡ Using optimized pickle files for faster predictions
                </p>
            </fieldset>
        </form>

        <!-- Prediction Form -->
        <form action="{{ url_for('predict') }}" method="post" style="animation: fadeInUp 0.8s ease-out;">
            <input type="hidden" name="dataset" value="{{ selected_dataset or 'day' }}" />
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="weather">ğŸŒ¤ï¸ Weather Condition</label>
                    <select id="weather" name="weather" required>
                        <option value="1">Clear / Partly Cloudy</option>
                        <option value="2">Mist / Cloudy</option>
                        <option value="3">Light Rain / Snow</option>
                        <option value="4">Heavy Rain / Snow</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="season">ğŸ‚ Season</label>
                    <select id="season" name="Seasons" required>
                        <option value="1">Spring</option>
                        <option value="2">Summer</option>
                        <option value="3">Fall</option>
                        <option value="4">Winter</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="temperature">ğŸŒ¡ï¸ Temperature (Â°C)</label>
                    <input type="number" step="0.1" id="temperature" name="temp" placeholder="-10 to 40" min="-15" max="45" required>
                    <small style="color: #9aa0b4; font-size: 12px; margin-top: 4px; display: block;">Enter temperature in Celsius (e.g., 25.5)</small>
                </div>

                <div class="form-group">
                    <label for="humidity">ğŸ’§ Humidity (%)</label>
                    <input type="number" step="1" id="humidity" name="hum" placeholder="0 to 100" min="0" max="100" required>
                    <small style="color: #9aa0b4; font-size: 12px; margin-top: 4px; display: block;">Enter humidity percentage (e.g., 65)</small>
                </div>

                <div class="form-group">
                    <label for="month">ğŸ“… Month</label>
                    <select id="month" name="Month" required>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="windspeed">ğŸ’¨ Wind Speed (km/h)</label>
                    <input type="number" step="0.1" id="windspeed" name="windspeed" placeholder="0 to 60" min="0" max="80" required>
                    <small style="color: #9aa0b4; font-size: 12px; margin-top: 4px; display: block;">Enter wind speed in km/h (e.g., 15.5)</small>
                </div>

                <div class="form-group">
                    <label for="year">ğŸ“† Year</label>
                    <select id="year" name="yr" required>
                        <option value="0">2011 (baseline)</option>
                        <option value="1">2012+</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="holiday">ğŸ‰ Holiday?</label>
                    <select id="holiday" name="holiday" required>
                        <option value="0">No</option>
                        <option value="1">Yes</option>
                    </select>
                </div>
            </div>

            <div style="margin-top: 32px; text-align: center;">
                <button type="submit" style="min-width: 300px; font-size: 18px;">
                    ğŸ”® Get Prediction
                </button>
            </div>

            {% if prediction_text %}
            <div class="prediction-result">
                <h2>{{ prediction_text }}</h2>
                <p class="muted">Based on {{ selected_dataset or 'day' }} model with {{ '53' if (selected_dataset or 'day')=='day' else '55' }} engineered features</p>
            </div>
            {% endif %}

            <div class="action-buttons">
                <button type="button" onclick="location.href='/';" style="background: rgba(255,255,255,0.05);">
                    â† Back to Home
                </button>
            </div>
        </form>
        
        <!-- Help section with value ranges -->
        <div style="background: rgba(102, 126, 234, 0.05); padding: 20px; border-radius: 12px; margin-top: 24px; font-size: 14px;">
            <h3 style="margin: 0 0 12px 0; color: #667eea;">ğŸ“‹ Input Value Guidelines</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                <div>
                    <strong>ğŸŒ¡ï¸ Temperature:</strong><br>
                    Summer: 25-35Â°C<br>
                    Winter: -5-15Â°C<br>
                    Spring/Fall: 10-25Â°C
                </div>
                <div>
                    <strong>ğŸ’§ Humidity:</strong><br>
                    Low: 20-40%<br>
                    Moderate: 40-70%<br>
                    High: 70-95%
                </div>
                <div>
                    <strong>ğŸ’¨ Wind Speed:</strong><br>
                    Calm: 0-10 km/h<br>
                    Moderate: 10-25 km/h<br>
                    Strong: 25+ km/h
                </div>
                <div>
                    <strong>ğŸŒ¤ï¸ Weather:</strong><br>
                    1: Clear/Sunny<br>
                    2: Cloudy/Mist<br>
                    3: Light Rain/Snow<br>
                    4: Heavy Rain/Snow
                </div>
            </div>
        </div>
    </div>

    <script>
        // Real-time input validation and feedback
        document.addEventListener('DOMContentLoaded', function() {
            const tempInput = document.getElementById('temperature');
            const humInput = document.getElementById('humidity');
            const windInput = document.getElementById('windspeed');
            
            // Add input event listeners for real-time feedback
            tempInput.addEventListener('input', function() {
                validateTemperature(this.value);
            });
            
            humInput.addEventListener('input', function() {
                validateHumidity(this.value);
            });
            
            windInput.addEventListener('input', function() {
                validateWindSpeed(this.value);
            });
            
            function validateTemperature(value) {
                const temp = parseFloat(value);
                const small = tempInput.nextElementSibling;
                
                if (isNaN(temp)) return;
                
                if (temp < -10) {
                    small.style.color = '#ff6b6b';
                    small.textContent = 'ğŸ¥¶ Very cold! Are you sure? (Below -10Â°C)';
                } else if (temp > 40) {
                    small.style.color = '#ff6b6b';
                    small.textContent = 'ğŸ”¥ Very hot! Are you sure? (Above 40Â°C)';
                } else if (temp >= -5 && temp <= 35) {
                    small.style.color = '#51cf66';
                    small.textContent = 'âœ… Good temperature range for biking!';
                } else {
                    small.style.color = '#9aa0b4';
                    small.textContent = 'Enter temperature in Celsius (e.g., 25.5)';
                }
            }
            
            function validateHumidity(value) {
                const hum = parseFloat(value);
                const small = humInput.nextElementSibling;
                
                if (isNaN(hum)) return;
                
                if (hum < 0 || hum > 100) {
                    small.style.color = '#ff6b6b';
                    small.textContent = 'âš ï¸ Humidity must be between 0-100%';
                } else if (hum >= 40 && hum <= 70) {
                    small.style.color = '#51cf66';
                    small.textContent = 'âœ… Ideal humidity for bike rentals!';
                } else if (hum > 80) {
                    small.style.color = '#ffd43b';
                    small.textContent = 'ğŸ’§ High humidity - may reduce rentals';
                } else {
                    small.style.color = '#9aa0b4';
                    small.textContent = 'Enter humidity percentage (e.g., 65)';
                }
            }
            
            function validateWindSpeed(value) {
                const wind = parseFloat(value);
                const small = windInput.nextElementSibling;
                
                if (isNaN(wind)) return;
                
                if (wind < 0) {
                    small.style.color = '#ff6b6b';
                    small.textContent = 'âš ï¸ Wind speed cannot be negative';
                } else if (wind > 50) {
                    small.style.color = '#ff6b6b';
                    small.textContent = 'ğŸŒªï¸ Very windy! This will significantly reduce rentals';
                } else if (wind <= 15) {
                    small.style.color = '#51cf66';
                    small.textContent = 'âœ… Great wind conditions for biking!';
                } else if (wind <= 30) {
                    small.style.color = '#ffd43b';
                    small.textContent = 'ğŸ’¨ Moderate wind - slight impact on rentals';
                } else {
                    small.style.color = '#9aa0b4';
                    small.textContent = 'Enter wind speed in km/h (e.g., 15.5)';
                }
            }
            
            // Set some reasonable default values
            if (!tempInput.value) tempInput.value = '22';
            if (!humInput.value) humInput.value = '55';
            if (!windInput.value) windInput.value = '12';
            
            // Trigger initial validation
            validateTemperature(tempInput.value);
            validateHumidity(humInput.value);
            validateWindSpeed(windInput.value);
        });
    </script>
</body>
</html>
