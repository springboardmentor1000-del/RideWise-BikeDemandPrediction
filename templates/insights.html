<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Insights - Bike Rental Analytics</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #0f1222 0%, #1a1f3b 100%); 
            margin: 0; 
            color: #e6e7ee; 
            min-height: 100vh;
        }
        .container { 
            max-width: 1400px; 
            margin: 80px auto 40px; 
            padding: 0 24px; 
        }
        
        /* Hero Section */
        .hero { 
            text-align: center;
            padding: 40px 20px;
            margin-bottom: 40px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        .hero-title { 
            font-size: 42px; 
            font-weight: 800; 
            background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
        }
        .hero-subtitle { 
            color: #9aa0b4; 
            font-size: 16px; 
            max-width: 600px; 
            margin: 0 auto;
        }
        
        /* Stats Cards */
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 40px;
        }
        .stat-card { 
            background: linear-gradient(135deg, #1a1f3b 0%, #2a2f52 100%);
            border-radius: 16px; 
            padding: 24px; 
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(102, 126, 234, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 48px rgba(102, 126, 234, 0.2);
        }
        .stat-icon { 
            font-size: 36px; 
            margin-bottom: 12px; 
        }
        .stat-value { 
            font-size: 32px; 
            font-weight: 700; 
            color: #667eea; 
            margin-bottom: 8px;
        }
        .stat-label { 
            color: #9aa0b4; 
            font-size: 14px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Charts Grid */
        .charts-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); 
            gap: 24px; 
            margin-bottom: 40px;
        }
        .chart-card { 
            background: linear-gradient(135deg, #1a1f3b 0%, #252b4a 100%);
            border-radius: 16px; 
            padding: 28px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }
        .chart-card.full-width {
            grid-column: 1 / -1;
        }
        .chart-title { 
            font-size: 20px; 
            font-weight: 700; 
            margin-bottom: 8px;
            color: #e6e7ee;
        }
        .chart-subtitle { 
            color: #9aa0b4; 
            font-size: 13px; 
            margin-bottom: 20px;
        }
        
        /* Insights Section */
        .insights-section {
            margin-top: 40px;
        }
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }
        .insight-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 14px;
            padding: 24px;
            border-left: 4px solid #667eea;
        }
        .insight-icon {
            font-size: 28px;
            margin-bottom: 12px;
        }
        .insight-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #f093fb;
        }
        .insight-text {
            color: #c9cdf0;
            font-size: 14px;
            line-height: 1.6;
        }
        
        /* Section Headers */
        .section-header {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 24px;
            color: #e6e7ee;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .section-header::before {
            content: '';
            width: 4px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #f093fb 100%);
            border-radius: 2px;
        }
        
        /* Canvas styling */
        canvas {
            max-height: 350px !important;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            .hero-title {
                font-size: 32px;
            }
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="topnav">
        <div class="left">
            <a href="/">Home</a>
            <a href="{{ url_for('index') }}">Prediction</a>
            <a class="active" href="{{ url_for('insights') }}">AI Insights</a>
            <a href="{{ url_for('chatbot') }}">Chatbot</a>
            <a href="{{ url_for('contact') }}">Contact</a>
        </div>
        <div class="right">
            <span style="color: var(--text-muted); margin-right: 16px;">üë§ Admin</span>
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>

    <div class="container">
        <!-- Hero Section -->
        <div class="hero">
            <div class="hero-title">ü§ñ AI-Powered Analytics Dashboard</div>
            <div class="hero-subtitle">
                Deep insights into bike rental patterns using machine learning models trained on historical data
            </div>
        </div>

        <!-- Key Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üö¥</div>
                <div class="stat-value">{{ "{:,}".format(stats.total_rentals) if stats.total_rentals else 'N/A' }}</div>
                <div class="stat-label">Total Rentals</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üìä</div>
                <div class="stat-value">{{ "{:,}".format(stats.avg_daily_rentals) if stats.avg_daily_rentals else 'N/A' }}</div>
                <div class="stat-label">Avg Daily Rentals</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è∞</div>
                <div class="stat-value">{{ stats.peak_hour if stats.peak_hour else 'N/A' }}:00</div>
                <div class="stat-label">Peak Hour</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üåû</div>
                <div class="stat-value">{{ stats.best_season if stats.best_season else 'N/A' }}</div>
                <div class="stat-label">Best Season</div>
            </div>
        </div>

        <!-- Feature Importance Charts -->
        <h2 class="section-header">üìà Model Feature Importance</h2>
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title">üåÖ Day Model - Top Features</div>
                <div class="chart-subtitle">Features that most influence daily rental predictions</div>
                <canvas id="chartDay"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">‚è±Ô∏è Hour Model - Top Features</div>
                <div class="chart-subtitle">Features that most influence hourly rental predictions</div>
                <canvas id="chartHour"></canvas>
            </div>
        </div>

        <!-- Rental Patterns -->
        <h2 class="section-header">üìä Rental Patterns Analysis</h2>
        <div class="charts-grid">
            <div class="chart-card">
                <div class="chart-title">üå¶Ô∏è Rentals by Season</div>
                <div class="chart-subtitle">Average bike rentals across different seasons</div>
                <canvas id="chartSeason"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">‚òÄÔ∏è Rentals by Weather</div>
                <div class="chart-subtitle">Impact of weather conditions on bike demand</div>
                <canvas id="chartWeather"></canvas>
            </div>
            <div class="chart-card full-width">
                <div class="chart-title">üïê Hourly Rental Patterns</div>
                <div class="chart-subtitle">24-hour demand pattern showing peak and off-peak hours</div>
                <canvas id="chartHourly"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">üå°Ô∏è Temperature Impact</div>
                <div class="chart-subtitle">How temperature affects rental demand</div>
                <canvas id="chartTemp"></canvas>
            </div>
            <div class="chart-card">
                <div class="chart-title">üíº Working Day vs Holiday</div>
                <div class="chart-subtitle">Rental patterns comparison</div>
                <canvas id="chartWorkday"></canvas>
            </div>
        </div>

        <!-- AI Insights -->
        <h2 class="section-header">üí° Key Insights & Recommendations</h2>
        <div class="insights-grid">
            <div class="insight-card">
                <div class="insight-icon">üéØ</div>
                <div class="insight-title">Optimal Operating Hours</div>
                <div class="insight-text">
                    Peak demand occurs around {{ stats.peak_hour if stats.peak_hour else '17' }}:00. 
                    Ensure maximum bike availability during 7-9 AM and 5-7 PM for commuter traffic.
                </div>
            </div>
            <div class="insight-card">
                <div class="insight-icon">üå§Ô∏è</div>
                <div class="insight-title">Weather Strategy</div>
                <div class="insight-text">
                    Clear weather drives the highest rentals. Consider dynamic pricing during ideal weather conditions 
                    and promotional offers during light rain to maintain demand.
                </div>
            </div>
            <div class="insight-card">
                <div class="insight-icon">üìÖ</div>
                <div class="insight-title">Seasonal Planning</div>
                <div class="insight-text">
                    {{ stats.best_season if stats.best_season else 'Fall' }} shows peak demand. 
                    Schedule maintenance during low seasons and stock up inventory before peak seasons.
                </div>
            </div>
            <div class="insight-card">
                <div class="insight-icon">üå°Ô∏è</div>
                <div class="insight-title">Temperature Sweet Spot</div>
                <div class="insight-text">
                    Moderate to warm temperatures (20-25¬∞C) are ideal for bike rentals. 
                    Plan marketing campaigns around comfortable weather forecasts.
                </div>
            </div>
            <div class="insight-card">
                <div class="insight-icon">üíº</div>
                <div class="insight-title">Workday Patterns</div>
                <div class="insight-text">
                    Working days show {{ "higher" if stats.workday_avg > stats.holiday_avg else "similar" }} demand 
                    compared to holidays. Focus bike placement near office areas on weekdays.
                </div>
            </div>
            <div class="insight-card">
                <div class="insight-icon">ü§ñ</div>
                <div class="insight-title">ML Model Accuracy</div>
                <div class="insight-text">
                    Our gradient boosting models consider 53+ features including weather interactions, 
                    time patterns, and seasonal trends for highly accurate predictions.
                </div>
            </div>
        </div>
    </div>

    <script>
        // Chart.js default configuration
        Chart.defaults.color = '#9aa0b4';
        Chart.defaults.font.family = "'Segoe UI', sans-serif";
        
        // Gradient colors
        const gradientPurple = (ctx) => {
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(102, 126, 234, 0.8)');
            gradient.addColorStop(1, 'rgba(118, 75, 162, 0.4)');
            return gradient;
        };
        
        const gradientPink = (ctx) => {
            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(240, 147, 251, 0.8)');
            gradient.addColorStop(1, 'rgba(245, 87, 108, 0.4)');
            return gradient;
        };

        // Feature Importance - Day Model
        const ctxDay = document.getElementById('chartDay').getContext('2d');
        new Chart(ctxDay, {
            type: 'bar',
            data: {
                labels: {{ day_labels | tojson }},
                datasets: [{
                    label: 'Importance (%)',
                    data: {{ day_values | tojson }},
                    backgroundColor: gradientPurple(ctxDay),
                    borderColor: '#667eea',
                    borderWidth: 2,
                    borderRadius: 8,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (context) => `Importance: ${context.parsed.y.toFixed(2)}%`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(102, 126, 234, 0.1)' },
                        ticks: { callback: (value) => value + '%' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { maxRotation: 45, minRotation: 45 }
                    }
                }
            }
        });

        // Feature Importance - Hour Model
        const ctxHour = document.getElementById('chartHour').getContext('2d');
        new Chart(ctxHour, {
            type: 'bar',
            data: {
                labels: {{ hour_labels | tojson }},
                datasets: [{
                    label: 'Importance (%)',
                    data: {{ hour_values | tojson }},
                    backgroundColor: gradientPink(ctxHour),
                    borderColor: '#f093fb',
                    borderWidth: 2,
                    borderRadius: 8,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (context) => `Importance: ${context.parsed.y.toFixed(2)}%`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(240, 147, 251, 0.1)' },
                        ticks: { callback: (value) => value + '%' }
                    },
                    x: {
                        grid: { display: false },
                        ticks: { maxRotation: 45, minRotation: 45 }
                    }
                }
            }
        });

        // Season Chart
        const ctxSeason = document.getElementById('chartSeason').getContext('2d');
        new Chart(ctxSeason, {
            type: 'doughnut',
            data: {
                labels: {{ stats.season_labels | tojson }},
                datasets: [{
                    data: {{ stats.season_counts | tojson }},
                    backgroundColor: [
                        'rgba(102, 204, 102, 0.8)',
                        'rgba(255, 206, 86, 0.8)',
                        'rgba(255, 159, 64, 0.8)',
                        'rgba(54, 162, 235, 0.8)'
                    ],
                    borderColor: '#1a1f3b',
                    borderWidth: 3
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 15, font: { size: 12 } } },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (context) => `${context.label}: ${context.parsed} rentals`
                        }
                    }
                }
            }
        });

        // Weather Chart
        const ctxWeather = document.getElementById('chartWeather').getContext('2d');
        new Chart(ctxWeather, {
            type: 'bar',
            data: {
                labels: {{ stats.weather_labels | tojson }},
                datasets: [{
                    label: 'Avg Rentals',
                    data: {{ stats.weather_counts | tojson }},
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.8)',
                        'rgba(154, 160, 180, 0.8)',
                        'rgba(54, 162, 235, 0.8)',
                        'rgba(240, 147, 251, 0.8)'
                    ],
                    borderRadius: 8,
                    borderWidth: 2,
                    borderColor: '#667eea'
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(102, 126, 234, 0.1)' }
                    },
                    x: { grid: { display: false } }
                }
            }
        });

        // Hourly Pattern Chart
        const ctxHourly = document.getElementById('chartHourly').getContext('2d');
        new Chart(ctxHourly, {
            type: 'line',
            data: {
                labels: {{ stats.hour_labels_chart | tojson }},
                datasets: [{
                    label: 'Avg Rentals',
                    data: {{ stats.hourly_avg | tojson }},
                    borderColor: '#667eea',
                    backgroundColor: gradientPurple(ctxHourly),
                    fill: true,
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 4,
                    pointBackgroundColor: '#f093fb',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            title: (items) => `Hour: ${items[0].label}:00`,
                            label: (context) => `Rentals: ${context.parsed.y}`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(102, 126, 234, 0.1)' }
                    },
                    x: {
                        grid: { color: 'rgba(102, 126, 234, 0.05)' },
                        ticks: { callback: (value) => value + ':00' }
                    }
                }
            }
        });

        // Temperature Impact Chart
        const ctxTemp = document.getElementById('chartTemp').getContext('2d');
        new Chart(ctxTemp, {
            type: 'bar',
            data: {
                labels: {{ stats.temp_labels | tojson }},
                datasets: [{
                    label: 'Avg Rentals',
                    data: {{ stats.temp_rentals | tojson }},
                    backgroundColor: gradientPink(ctxTemp),
                    borderColor: '#f093fb',
                    borderWidth: 2,
                    borderRadius: 8
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(240, 147, 251, 0.1)' }
                    },
                    x: { grid: { display: false } }
                }
            }
        });

        // Workday vs Holiday Chart
        const ctxWorkday = document.getElementById('chartWorkday').getContext('2d');
        new Chart(ctxWorkday, {
            type: 'polarArea',
            data: {
                labels: ['Working Day', 'Holiday'],
                datasets: [{
                    data: [{{ stats.workday_avg }}, {{ stats.holiday_avg }}],
                    backgroundColor: [
                        'rgba(102, 126, 234, 0.7)',
                        'rgba(240, 147, 251, 0.7)'
                    ],
                    borderColor: '#1a1f3b',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom', labels: { padding: 15 } },
                    tooltip: {
                        backgroundColor: 'rgba(26, 31, 59, 0.95)',
                        padding: 12,
                        cornerRadius: 8,
                        callbacks: {
                            label: (context) => `${context.label}: ${context.parsed.r} rentals`
                        }
                    }
                },
                scales: {
                    r: {
                        grid: { color: 'rgba(102, 126, 234, 0.1)' },
                        ticks: { display: false }
                    }
                }
            }
        });
    </script>
</body>
</html>
